with = block(
    obj = call message arg(0, call sender)
    res = call message arg(1, call sender)
    obj close
    res
)

open = block(filename,
    return File clone open(filename)
)

import = block(
    name = call message args at(0) name
    self set(name, Importer import(name))
    None
)

Module = Object clone do (

    init = method(name, filename, code,
        self __name__ = name
        self __file__ = filename
        eval(code, self)
    )

    repr = method(
        "<Module " + self __name__ repr + " from " + self __file__ repr + ">"
    )
)

Importer = Object clone do (
    paths = List clone

    import  = method(name,
        filename = name + ".mio"
        with(f = open(filename),
            return Module clone(name, filename, f read)
        )
    )
)
